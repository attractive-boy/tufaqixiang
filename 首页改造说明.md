# 首页改造说明 - 集成携程地标数据

## 改造概述

本次改造将首页的**顶部轮播图**和**地标评分模块**由硬编码数据改为从携程API实时获取北京地标数据，展示真实的景点封面图、评分和信息。

## 改动文件

### 1. 新增文件：`/tufaqixiang/utils/ctrip-api.js`
   
携程API服务模块，提供以下功能：

- **getAttractionsList(options)**: 获取景点列表的通用方法
  - 参数：
    - `index`: 页码（默认1）
    - `count`: 每页数量（默认20）
    - `districtId`: 城市ID（默认1-北京）
    - `sortType`: 排序方式（0-综合，1-人气，2-好评）
  - 返回：格式化的景点数据数组

- **getBeijingLandmarks(limit)**: 获取北京热门地标
  - 参数：`limit` - 获取数量（默认10）
  - 返回：按评分降序排列的地标数据

- **getBeijingPopularSpots(limit)**: 获取北京热门景点（按人气）
  - 参数：`limit` - 获取数量（默认10）
  - 返回：按人气排序的景点数据

- **CITY_IDS**: 城市ID常量，包含北京、上海、广州等主要城市

### 2. 修改文件：`/tufaqixiang/pages/index/index.vue`

**Script部分改动：**
- 导入 `getBeijingLandmarks` 方法
- 将 `landmarks` 和 `heroImages` 从静态数据改为动态获取
- 合并数据加载逻辑到 `loadBeijingLandmarks()` 方法
- 移除原有的 `refreshHeroImages()` 方法
- 一次性获取12个地标：前3个用于轮播图，后8个用于地标列表
- 增加加载状态管理 `landmarksLoading`
- 添加错误处理和降级方案

**Template部分改动：**
- 标题从"地标评分"改为"北京地标评分"，更明确
- 地标卡片增加评论数展示
- 优化信息层级结构

**Style部分改动：**
- 优化 `.landmark-info` 布局为纵向排列
- 新增 `.landmark-main` 样式
- 新增 `.landmark-meta` 和 `.landmark-comments` 样式
- 增加字体权重和间距优化

## 数据结构

### API返回的地标数据格式：

```javascript
{
  id: "87211",              // 景点ID
  poiId: "75595",           // POI ID
  name: "故宫",             // 景点名称
  eName: "Forbidden City",  // 英文名
  rating: 4.8,              // 评分
  commentCount: 12345,      // 评论数
  image: "https://...",     // 封面图片URL
  price: 60,                // 价格
  minPrice: 40,             // 最低价格
  latitude: 39.916345,      // 纬度
  longitude: 116.397155,    // 经度
  tags: ["5A景区", "世界遗产"],  // 标签数组
  features: ["特色1", "特色2"],  // 特色数组
  address: "北京市东城区..."     // 地址
}
```

## 功能特点

1. **实时数据**：从携程API获取最新的北京地标数据
2. **统一数据源**：顶部轮播图和地标列表使用同一数据源
3. **智能分配**：前3个高评分地标图片作为轮播图，后8个作为地标列表
4. **智能排序**：按评分降序排列，只展示有评分的地标
5. **容错机制**：如果API请求失败，自动降级使用默认数据
6. **加载提示**：请求数据时显示加载动画
7. **数据展示**：展示地标名称、评分（星级）、评论数
8. **性能优化**：一次请求获取所有数据，避免多次API调用

## 使用方法

### 运行项目

项目会在首页加载时自动调用API获取北京地标数据，无需额外配置。
- 顶部轮播图展示前3个高评分地标的封面图
- 地标评分区域展示后8个地标的详细信息（名称、评分、评论数）

### 切换其他城市

如需获取其他城市的地标数据，可修改 `index.vue` 中的调用：

```javascript
// 在 loadBeijingLandmarks 方法中修改
import { getAttractionsList, CITY_IDS } from '@/utils/ctrip-api.js';

// 获取上海地标
const landmarks = await getAttractionsList({
  index: 1,
  count: 30,
  districtId: CITY_IDS.SHANGHAI,
  sortType: 2
});
```

## 注意事项

1. **网络依赖**：需要网络连接才能获取数据
2. **图片加载**：景点图片来自携程CDN，首次加载可能较慢
3. **跨域问题**：在开发环境可能需要配置代理
4. **API限制**：请勿频繁调用API，避免被限流

## 扩展建议

1. **缓存机制**：可以添加本地缓存，减少API请求
2. **下拉刷新**：添加下拉刷新功能更新地标数据
3. **详情页面**：点击地标卡片跳转到详情页，展示更多信息
4. **地图集成**：结合地图模块，在地图上标注地标位置
5. **筛选功能**：添加按标签、价格等条件筛选地标

## 技术栈

- **框架**: uni-app
- **数据源**: 携程移动端API
- **请求方式**: uni.request
- **数据格式**: JSON

## 相关文件

- `/Ctrip_Crawler-master/poi_crawl.py` - 携程爬虫参考实现
- `/Ctrip_Crawler-master/README.md` - 爬虫说明文档
- `/tufaqixiang/utils/ctrip-api.js` - API服务模块
- `/tufaqixiang/pages/index/index.vue` - 首页组件

## 更新日期

2026年2月25日
